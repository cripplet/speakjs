<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " vocab="http://ogp.me/ns" lang="en">
<head>

<meta charset="utf-8">
<title>SpeakerJS</title>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="/static/js/modernizr.js"></script>

</head>
<body>

getUserMedia(): <span class="getusermedia">not supported</span><br/>
HTML5 audio: <span class="audio">not supported</span><br/>
RTC Peer Connection: <span class="peerconnection">not supported</span><br/>
RTC Data Channels: <span class="datachannel">not supported</span><br/>
HTML5 video: <span class="video">not supported</span><br/>

<audio autoplay>
<source id="inputSource" type="audio/ogg" />
</audio>

<script type="text/javascript">
var success = function(localMediaStream) {
  var url = window.URL || window.webkitURL;

  var audioRecorder = new MediaRecorder(localMediaStream);
  var audioElement = document.querySelector('audio');
  audioRecorder.start();
  audioElement.src = url ? url.createObjectURL(localMediaStream) : localMediaStream;
  audioElement.play();

  audioRecorder.ondataavailable = function(e) {
    // console.log(e.data);
  }

  audioRecorder.onerror = function(e) {
    console.log(e);
  }
};

var failure = function(e) {
  window.alert("failure callback: could not gUM audio");
};

var main = function() {
  var gUM = Modernizr.prefixed("getUserMedia", navigator);
  gUM({video: false, audio: true}, success, failure);
};

$(document).ready(function() {
  var s = 0;
  if (Modernizr.getusermedia) {
    s += 1;
    $("span.getusermedia").text("supported");
  }
  if (Modernizr.audio) {
    s += 1;
    $("span.audio").text("supported");
  }
  if (Modernizr.peerconnection) {
    s += 1;
    $("span.peerconnection").text("supported");
  }
  if (Modernizr.datachannel) {
    s += 1;
    $("span.datachannel").text("supported");
  }
  if (Modernizr.video) {
    // optional
    $("span.video").text("supported");
  }
  if (s == 4) {
    main();
  }
});
</script>

</body>

</html>
