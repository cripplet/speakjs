<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " vocab="http://ogp.me/ns" lang="en">
<head>

<meta charset="utf-8">
<title>SpeakerJS Client</title>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /> 

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.6/handlebars.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/sprintf/1.0.3/sprintf.js"></script>
<script type="text/javascript" src="/static/js/modernizr.js"></script>
<script type="text/javascript" src="/static/js/peerjs/0.3.14/peer.js"></script>
<script type="text/javascript" src="/static/js/config.js"></script>
<script type="text/javascript" src="/static/js/lib.js"></script>
<script type="text/javascript" src="/static/js/client.js"></script>

</head>
<body>

<div id="client_info">
  <div id="client_client_id_key">Client ID</div>
  <div id="client_client_id_val"></div>
  <div id="client_server_id_key">Server ID</div>
  <div id="client_server_id_val"></div>
</div>

<form id="form_server_connect">
  <input id="form_server_connect_server_id" type="text" placeholder="server" />
  <input id="form_server_connect_username" type="text" placeholder="username" />
  <button type="submit">Connect</button>
  <button type="button" id="form_server_connect_drop">Drop</button>
</form>

<form id="form_chat">
  <input id="form_chat_content" type="text" placeholder="chat" />
  <button type="submit">Submit</button>
</form>

<button type="button" id="toggle_mic_mute">Mute</button>

<div id="client_peer_list">
  <div id="client_peer_list_key">Peers</div>
  <div id="client_peer_list_val"></div>
</div>

<div id="client_log">
  <div id="client_log_key">Chat Log</div>
  <div id="client_log_var"></div>
</div>

<script>
$(document).ready(function() {
  let server_value = getUrlParameter("server");
  if (server_value) {
    $("#form_server_connect_server_id").val(server_value);
  }

  let client = new ClientPeerJS(true);

  $("#form_server_connect").on("submit", function() {
    client.join($("#form_server_connect_server_id").val(), $("#form_server_connect_username").val());
    $("#form_server_connect_server_id").val("");
    $("#form_server_connect_username").val("");
    return false;
  });

  $("#form_chat").on("submit", function() {
    client.broadcast($("#form_chat_content").val());
    $("#form_chat_content").val("");
    return false;
  });

  $("#form_server_connect_drop").on("click", function() {
    client.drop();
  });

  $(layout.TOGGLE_MIC_MUTE).on("click", function() {
    client.toggle_mute();
  });

  window.addEventListener("unload", function(e) {
    client.peerjs.destroy();
  });
});
</script>

</body>

</html>
