<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " vocab="http://ogp.me/ns" lang="en">
<head>

<meta charset="utf-8">
<title>SpeakerJS</title>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="static/js/modernizr.js"></script>
<script src="static/js/config.js"></script>
<script src="http://cdn.peerjs.com/0.3/peer.min.js"></script>

</head>
<body>

<div id="forward_id_wrap">FORWARD ID: <span class="value" id="forward_id"></span></div>
<div id="init_status_wrap">INIT STATUS: <span class="value" id="init_status"></span></div>

<script type="text/javascript">
var peer = new Peer(config);
var forward_id = $("span#forward_id");
var init_status = $("span#init_status");

var callOnStream = function(stream) {
  var audio = $("<audio autoplay />");
  audio[0].src = (URL || webkitURL || mozURL).createObjectURL(stream);
}

var peerOnCall = function(call) {
  navigator.mediaDevices.getUserMedia({audio: true}).then(function(stream) {
    call.answer(stream);
    init_status.text("connected");
    call.on("stream", callOnStream);
  });
}

var peerOnOpen = function(id) {
  forward_id.text(id);
  peer.on("call", peerOnCall);
}

$(document).ready(function() {
  peer.on("open", peerOnOpen);
});

</script>

</body>
</html>
