<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " vocab="http://ogp.me/ns" lang="en">
<head>

<meta charset="utf-8">
<title>SpeakerJS</title>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="static/js/modernizr.js"></script>
<script src="static/js/config.js"></script>
<script src="http://cdn.peerjs.com/0.3/peer.min.js"></script>

</head>
<body>

<div id="recv_id_wrap">RECV ID: <span class="value" id="recv_id"></span></div>
<div id="forward_status_wrap">FORWARD STATUS: <span class="value" id="forward_status"></span></div>

<script type="text/javascript">
var peer = new Peer(config);
var recv_id = $("span#recv_id");
var forward_status = $("span#forward_status");

var forward_id = null;
var forward_stream = null;

var callOnStream = function(stream) {
  forward_stream = stream;
  var audio = $("<audio autoplay />");
  audio[0].src = (URL || webkitURL || mozURL).createObjectURL(stream);
}

var peerOnCall = function(call) {
  forward_id = call.peer;
  call.answer();
  forward_status.text("connected");
  call.on("stream", callOnStream);
}

var peerOnOpen = function(id) {
  recv_id.text(id);
  peer.on("call", peerOnCall);
}

$(document).ready(function() {
  peer.on("open", peerOnOpen);
});

</script>

</body>
</html>
